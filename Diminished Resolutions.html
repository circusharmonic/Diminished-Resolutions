<!DOCTYPE html>
<!-- Version v52 - Diminished Resolutions Interface -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diminished Resolutions</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Helvetica, sans-serif;
        }
        #container {
            background: #2a2a2a;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            position: relative;
        }
        #title-container {
            position: absolute;
            top: 40px;
            left: 30px;
            color: white;
            z-index: 10;
            font-family: Helvetica, sans-serif;
        }
        #main-title {
            font-size: 34px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        #subtitle {
            font-size: 22px;
            font-style: italic;
        }
        #dropdown-container {
            position: absolute;
            left: 475px;
            top: 24px;
            margin-top: 20px;
            margin-bottom: 10px;
            z-index: 10;
        }
        #dropdown {
            background: #1a1a1a80;
            color: #ffffff;
            border: 2px solid #1a1a1a00;
            border-radius: 8px;
            width: 220px;
            height: 36px;
            padding: 8px 19px;
            font-family: Helvetica, sans-serif;
            font-size: 14px;
            cursor: pointer;
            outline: none;
        }
        #main-content {
            width: 680px;
            height: 500px;
            position: relative;
            margin-top: 32px;
        }
        
        /* Label text */
        #label-container {
            position: absolute;
            left: 0;
            top: 440px;
            width: 680px;
            height: 60px;
        }
        
        .label-text {
            position: absolute;
            font-size: 22px;
            color: white;
        }
        
        #left-label {
            left: 120px;
            transform: translateX(-50%);
        }
        
        #right-label {
            left: 565px;
            transform: translateX(-50%);
        }
        
        .arrow {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            font-size: 36px;
            color: white;
            width: 180px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .arrow svg {
            width: 100%;
            height: 100%;
        }
        
        /* Circle of Fifths */
        #circle-container {
            position: absolute;
            left: 0;
            top: 40px;
            width: 240px;
            height: 400px;
        }
        
        .note-circle {
            position: absolute;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(26, 26, 26, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
            cursor: pointer;
            transform: translate(-50%, -50%);
            transition: background 0.15s ease, width 0.15s ease, height 0.15s ease;
        }
        
        .note-circle.active.red {
            background: rgba(255, 61, 64, 1);
            width: 46.64px;
            height: 46.64px;
        }
        
        .note-circle.active.green {
            background: rgba(51, 230, 107, 1);
            width: 46.64px;
            height: 46.64px;
        }
        
        #center-text {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            color: white;
            text-align: center;
        }
        
        /* Chart */
        #chart-container {
            position: absolute;
            left: 250px;
            top: 40px;
            width: 430px;
            height: 400px;
        }
        
        #svg-lines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .left-box {
            position: absolute;
            height: 36px;
            border-radius: 8px;
            background: rgba(255, 119, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: white;
            cursor: pointer;
            transition: background 0.15s ease, width 0.15s ease;
        }
        
        .left-box.narrow {
            width: 80px;
        }
        
        .left-box.wide {
            width: 220px;
        }
        
        .left-box.active {
            background: rgba(255, 119, 0, 1);
        }
        
        .right-box {
            position: absolute;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: white;
            transition: background 0.15s ease, width 0.15s ease;
        }
        
        .right-box.narrow {
            width: 80px;
        }
        
        .right-box.wide {
            width: 220px;
        }
        
        .right-box.green {
            background: rgba(51, 230, 107, 0.6);
        }
        
        .right-box.red {
            background: rgba(255, 61, 64, 0.6);
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="title-container">
            <div id="main-title">Diminished Resolutions</div>
            <div id="subtitle">by CircusHarmonic</div>
        </div>
        <div id="dropdown-container">
            <select id="dropdown">
                <option value="0">Diminished → Resolution</option>
                <option value="1">Resolution → Diminished</option>
            </select>
        </div>
        <div id="main-content">
            <div id="circle-container">
                <div id="center-text"></div>
            </div>
            <div id="chart-container">
                <svg id="svg-lines"></svg>
            </div>
            <div id="label-container">
                <span id="left-label" class="label-text">Diminished</span>
                <span id="arrow" class="arrow">
                    <svg viewBox="0 0 180 36" xmlns="http://www.w3.org/2000/svg">
                        <line x1="9" y1="13" x2="157.5" y2="13" stroke="white" stroke-width="2.7"/>
                        <polygon points="171,13 153,5.8 153,20.2" fill="white"/>
                    </svg>
                </span>
                <span id="right-label" class="label-text">Resolution</span>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // MODE CONFIGURATIONS
        // ========================================
        const MODE_CONFIG = {
            0: { // Diminished -> Resolution
                numLeftBoxes: 4,
                numRightBoxes: 6,
                leftBoxWidth: 80,
                leftBoxClass: 'narrow',
                rightBoxWidth: 220,
                rightBoxClass: 'wide',
                circleActiveClass: 'red',
                rightBoxColorClass: 'green',
                leftLabel: 'Diminished',
                rightLabel: 'Resolution',
                centerText: '°7 Pivot Chord',
                leftBoxX: 45,
                curvature: 26,
                arrowSVG: `
                    <svg viewBox="0 0 180 36" xmlns="http://www.w3.org/2000/svg">
                        <line x1="9" y1="13" x2="157.5" y2="13" stroke="white" stroke-width="2.7"/>
                        <polygon points="171,13 153,5.8 153,20.2" fill="white"/>
                    </svg>
                `
            },
            1: { // Resolution -> Diminished
                numLeftBoxes: 6,
                numRightBoxes: 4,
                leftBoxWidth: 220,
                leftBoxClass: 'wide',
                rightBoxWidth: 80,
                rightBoxClass: 'narrow',
                circleActiveClass: 'green',
                rightBoxColorClass: 'red',
                leftLabel: 'Resolution',
                rightLabel: 'Diminished',
                centerText: 'Resolution Key',
                leftBoxX: 65,
                curvature: 20,
                arrowSVG: `
                    <svg viewBox="0 0 180 36" xmlns="http://www.w3.org/2000/svg">
                        <line x1="22.5" y1="13" x2="171" y2="13" stroke="white" stroke-width="2.7"/>
                        <polygon points="9,13 27,5.8 27,20.2" fill="white"/>
                    </svg>
                `
            }
        };

        // ========================================
        // GLOBAL VARIABLES
        // ========================================
        const notes = ['C', 'G', 'D', 'A', 'E', 'B', 'F#', 'Db', 'Ab', 'Eb', 'Bb', 'F'];
        let activeNote = 0;
        let rotationOffset = 0;
        let targetRotation = 0;
        let animating = false;
        const animationSpeed = 0.12;
        let activeLeftBox = 0;
        let dropdownMode = 0; // 0 = Diminished->Resolution, 1 = Resolution->Diminished

        // Box quantity variables
        let numLeftBoxes = 4;
        let numRightBoxes = 6;

        const circleContainer = document.getElementById('circle-container');
        const chartContainer = document.getElementById('chart-container');
        const svgLines = document.getElementById('svg-lines');

        const centerX = 120;
        const centerY = 200;
        const outerRadius = 93.6;
        const boxHeight = 36;
        const spacing = 20;
        
        let centerText = '°7 Pivot Chord';
        const centerTextElement = document.getElementById('center-text');
        // ========================================
        // BOX DATA
        // ========================================


        let domlist = [
            { label: "B7" },
            { label: "D7" },
            { label: "F7" },
            { label: "Ab7" }
        ];

        let reslist = [
            { label: "E (Perfect)" },
            { label: "Db (Back Door)" },
            { label: "C (Screen Door)" },
            { label: "Bb (Tritone Perfect)" },
            { label: "G (Tritone Back Door)" },
            { label: "F# (Tritone Screen Door / Plagal)" }
        ];

        let dimlist = [
            { label: "Ab°7" },
            { label: "F°7" },
            { label: "D°7" },
            { label: "B°7" }
        ];

        let dompivotlist = [
            { label: "G (Perfect)" },
            { label: "Bb (Back Door)" },
            { label: "B (Screen Door)" },
            { label: "Db (Tritone Perfect)" },
            { label: "E (Tritone Back Door)" },
            { label: "F (Tritone Screen Door / Plagal)" }
        ];

        let leftBoxes = domlist;
        let rightBoxes = reslist;

        // ========================================
        // NOTE CIRCLE CREATION
        // ========================================
        const noteElements = [];
        notes.forEach((note, i) => {
            const el = document.createElement('div');
            el.className = 'note-circle';
            el.textContent = note;
            el.dataset.index = i;
            circleContainer.appendChild(el);
            noteElements.push(el);
            
            el.addEventListener('click', () => {
                activeNote = i;
                targetRotation = i * 30;
                animating = true;

                switch (dropdownMode) {
                    case 0:
                        calculatedoms(activeNote);
                        dom7labels(dom1, dom2, dom3, dom4);
                        calculateresolutions(activeLeftBox);
                        resolutionlabels(res1, res2, res3, res4, res5, res6);
                        break;
                    case 1:
                        calculatepivots(activeNote);
                        resolutionlabels(piv1, piv2, piv3, piv4, piv5, piv6);
                        calculatedims(activeLeftBox);
                        dim7labels(dim1, dim2, dim3, dim4);
                        break;
                }
                updateLeftBoxes();
                updateRightBoxes();
                updateActiveStates();
                animate();
            });
        });

        // ========================================
        // BOX CREATION AND MANAGEMENT
        // ========================================
        let leftBoxElements = [];
        let rightBoxElements = [];
        
        function createBoxes() {
            const config = MODE_CONFIG[dropdownMode];
            
            // Clear existing boxes
            leftBoxElements.forEach(el => el.remove());
            rightBoxElements.forEach(el => el.remove());
            leftBoxElements = [];
            rightBoxElements = [];
            
            const totalHeightleft = (numLeftBoxes * boxHeight) + ((numLeftBoxes - 1) * spacing);
            const startYleft = (400 - totalHeightleft) / 2;
            const leftBoxX = config.leftBoxX;
            
            // Create left boxes
            for (let i = 0; i < numLeftBoxes; i++) {
                const el = document.createElement('div');
                el.className = 'left-box';
                el.classList.add(config.leftBoxClass);
                el.textContent = leftBoxes[i] ? leftBoxes[i].label : '';
                el.dataset.index = i;
                el.style.left = leftBoxX + 'px';
                el.style.top = (startYleft + (i * (boxHeight + spacing))) + 'px';
                chartContainer.appendChild(el);
                leftBoxElements.push(el);
                
                el.addEventListener('click', () => {
                    activeLeftBox = i;
                    switch (dropdownMode) {
                        case 0:
                            calculatedoms(activeNote);
                            dom7labels(dom1, dom2, dom3, dom4);
                            calculateresolutions(activeLeftBox);
                            resolutionlabels(res1, res2, res3, res4, res5, res6);
                            break;
                        case 1:
                            calculatepivots(activeNote);
                            resolutionlabels(piv1, piv2, piv3, piv4, piv5, piv6);
                            calculatedims(activeLeftBox);
                            dim7labels(dim1, dim2, dim3, dim4);
                            break;
                    }
                    updateLeftBoxes();
                    updateRightBoxes();
                    updateActiveStates();
                    drawLines();
                });
            }
            
            // Create right boxes - always aligned with circle center
            const totalHeightright = (numRightBoxes * boxHeight) + ((numRightBoxes - 1) * spacing);
            const startYright = (400 - totalHeightright) / 2;
            // Adjust rightBoxX to extend left when narrow
            const rightBoxX = dropdownMode === 0 ? leftBoxX + config.leftBoxWidth + 80 : leftBoxX + config.leftBoxWidth + 100 - 40;
            
            for (let i = 0; i < numRightBoxes; i++) {
                const el = document.createElement('div');
                el.className = 'right-box';
                el.classList.add(config.rightBoxClass);
                el.textContent = rightBoxes[i] ? rightBoxes[i].label : '';
                el.style.left = rightBoxX + 'px';
                el.style.top = (startYright + (i * (boxHeight + spacing))) + 'px';
                chartContainer.appendChild(el);
                rightBoxElements.push(el);
            }
            
            updateRightBoxColors();
        }

        // ========================================
        // MUSIC THEORY CALCULATIONS
        // ========================================
        let dom1 = '', dom2 = '', dom3 = '', dom4 = '';
        let res1 = '', res2 = '', res3 = '', res4 = '', res5 = '', res6 = '';
        let piv1 = '', piv2 = '', piv3 = '', piv4 = '', piv5 = '', piv6 = '';
        let dim1 = '', dim2 = '', dim3 = '', dim4 = '';

        function rotateleft(list, k) {
            const n = list.length;
            k = list.length - k;
            k %= n;
            const rotated = [];
            for (let i = 0; i < n; i++) {
                rotated[(i + k) % n] = list[i];
            }
            return rotated;
        }

        function calculatedoms(i) {
            let rotated5ths = rotateleft(notes, i);
            dom1 = rotated5ths[5];
            dom2 = rotated5ths[2];
            dom3 = rotated5ths[11];
            dom4 = rotated5ths[8];
        }

        function calculateresolutions(i) {
            const resolutionmap = [5, 2, 11, 8];
            let rotated5ths = rotateleft(notes, activeNote);
            let doublerotated5ths = rotateleft(rotated5ths, resolutionmap[i]);
            res1 = doublerotated5ths[11];
            res2 = doublerotated5ths[2];
            res3 = doublerotated5ths[7];
            res4 = doublerotated5ths[5];
            res5 = doublerotated5ths[8];
            res6 = doublerotated5ths[1];
        }

        function calculatepivots(i) {
            let rotated5ths = rotateleft(notes, i);
            piv1 = rotated5ths[1];
            piv2 = rotated5ths[10];
            piv3 = rotated5ths[5];
            piv4 = rotated5ths[7];
            piv5 = rotated5ths[4];
            piv6 = rotated5ths[11];
        }

        function calculatedims(i) {
            const resolutionmap = [1, 10, 5, 7, 4, 11];
            let rotated5ths = rotateleft(notes, activeNote);
            let doublerotated5ths = rotateleft(rotated5ths, resolutionmap[i]);
            dim1 = doublerotated5ths[7];
            dim2 = doublerotated5ths[10];
            dim3 = doublerotated5ths[1];
            dim4 = doublerotated5ths[4];
        }

        function dim7labels(i1, i2, i3, i4) {
            dimlist = [
                { label: i1 + "°7" },
                { label: i2 + "°7" },
                { label: i3 + "°7" },
                { label: i4 + "°7" }
            ];
            rightBoxes = dimlist;
        }

        function dom7labels(i1, i2, i3, i4) {
            domlist = [
                { label: i1 + "7" },
                { label: i2 + "7" },
                { label: i3 + "7" },
                { label: i4 + "7" }
            ];
            leftBoxes = domlist;
        }

        function resolutionlabels(i1, i2, i3, i4, i5, i6) {
            switch (dropdownMode) {
                case 0:
                    reslist = [
                        { label: " " + i1 + " (Perfect)" },
                        { label: " " + i2 + " (Back Door)" },
                        { label: " " + i3 + " (Screen Door)" },
                        { label: " " + i4 + " (Tritone Perfect)" },
                        { label: " " + i5 + " (Tritone Back Door)" },
                        { label: " " + i6 + " (Tritone Screen Door / Plagal)" }
                    ];
                    rightBoxes = reslist;
                    break;
                case 1:
                    dompivotlist = [
                        { label: " " + i1 + " (Perfect)" },
                        { label: " " + i2 + " (Back Door)" },
                        { label: " " + i3 + " (Screen Door)" },
                        { label: " " + i4 + " (Tritone Perfect)" },
                        { label: " " + i5 + " (Tritone Back Door)" },
                        { label: " " + i6 + " (Tritone Screen Door / Plagal)" }
                    ];
                    leftBoxes = dompivotlist;
                    break;
            }
        }

        function updateCenterText() {
            centerTextElement.textContent = centerText;
        }

        function updateNotePositions() {
            noteElements.forEach((el, i) => {
                const angle = (i * 30 - rotationOffset) * Math.PI / 180;
                const x = centerX + Math.cos(angle) * outerRadius;
                const y = centerY + Math.sin(angle) * outerRadius;
                el.style.left = x + 'px';
                el.style.top = y + 'px';
            });
        }

        function updateActiveStates() {
            const config = MODE_CONFIG[dropdownMode];
            noteElements.forEach((el, i) => {
                el.classList.remove('active', 'red', 'green');
                if (i === activeNote) {
                    el.classList.add('active');
                    el.classList.add(config.circleActiveClass);
                }
            });
            leftBoxElements.forEach((el, i) => {
                el.classList.toggle('active', i === activeLeftBox);
            });
        }

        function updateRightBoxColors() {
            const config = MODE_CONFIG[dropdownMode];
            rightBoxElements.forEach(el => {
                el.classList.remove('green', 'red');
                el.classList.add(config.rightBoxColorClass);
            });
        }

        function updateLeftBoxes() {
            switch (dropdownMode) {
                case 0:
                    leftBoxes = domlist;
                    break;
                case 1:
                    leftBoxes = dompivotlist;
                    break;
                }
            leftBoxElements.forEach((el, i) => {
                el.textContent = leftBoxes[i] ? leftBoxes[i].label : '';
            });
        }

        function updateRightBoxes() {
            switch (dropdownMode) {
                case 0:
                    rightBoxes = reslist;
                    break;
                case 1:
                    rightBoxes = dimlist;
                    break;
                }
            rightBoxElements.forEach((el, i) => {
                el.textContent = rightBoxes[i] ? rightBoxes[i].label : '';
            });
        }
        
        function drawLines() {
            const config = MODE_CONFIG[dropdownMode];
            const convergencePointX = 5;
            const convergenceY = 200;
          
            let paths = '';
        
            const totalHeightleft = (numLeftBoxes * boxHeight) + ((numLeftBoxes - 1) * spacing);
            const startYleft = (400 - totalHeightleft) / 2;
            const leftBoxX = config.leftBoxX;
        
            const leftBoxWidth = config.leftBoxWidth;
            const rightBoxX = dropdownMode === 0 ? leftBoxX + leftBoxWidth + 80 : leftBoxX + leftBoxWidth + 100 - 40;
        
            const totalHeightright = (numRightBoxes * boxHeight) + ((numRightBoxes - 1) * spacing);
            const startYright = (400 - totalHeightright) / 2;
            
            // Get curvature from config
            const curvature = config.curvature;
            
            // Left lines
            for (let i = 0; i < numLeftBoxes; i++) {
                const boxY = startYleft + (i * (boxHeight + spacing));
                const boxCenterY = boxY + boxHeight / 2;
                const controlX1 = convergencePointX + curvature;
                const controlX2 = leftBoxX - curvature;
                
                paths += `<path d="M ${convergencePointX} ${convergenceY} C ${controlX1} ${convergenceY}, ${controlX2} ${boxCenterY}, ${leftBoxX} ${boxCenterY}" stroke="rgba(255, 255, 255, 1)" stroke-width="2" fill="none"/>`;
                }
            
            // Right lines
            const activeBoxY = startYleft + (activeLeftBox * (boxHeight + spacing));
            const activeBoxCenterY = activeBoxY + boxHeight / 2;
            const activeBoxRightX = leftBoxX + leftBoxWidth + 10;
            
            for (let i = 0; i < numRightBoxes; i++) {
                const rightBoxY = startYright + (i * (boxHeight + spacing));
                const rightBoxCenterY = rightBoxY + boxHeight / 2;
                const controlX1 = activeBoxRightX + curvature;
                const controlX2 = rightBoxX - curvature;
                
                // Modified this line to stop at rightBoxX rather than going into the box
                paths += `<path d="M ${activeBoxRightX} ${activeBoxCenterY} C ${controlX1} ${activeBoxCenterY}, ${controlX2} ${rightBoxCenterY}, ${rightBoxX} ${rightBoxCenterY}" stroke="rgba(255, 255, 255, 1)" stroke-width="2" fill="none"/>`;
                }
            
            svgLines.innerHTML = paths;
        }

        // ========================================
        // ANIMATION
        // ========================================
        function animate() {
            if (!animating) return;
            
            let diff = targetRotation - rotationOffset;
            while (diff > 180) diff -= 360;
            while (diff < -180) diff += 360;
            
            if (Math.abs(diff) < 0.5) {
                rotationOffset = targetRotation;
                animating = false;
                updateNotePositions();
                return;
            }
            
            rotationOffset += diff * animationSpeed;
            while (rotationOffset >= 360) rotationOffset -= 360;
            while (rotationOffset < 0) rotationOffset += 360;
            
            updateNotePositions();
            requestAnimationFrame(animate);
        }

        // ========================================
        // INITIALIZATION
        // ========================================
        createBoxes();
        calculatedoms(activeNote);
        dom7labels(dom1, dom2, dom3, dom4);
        calculateresolutions(activeLeftBox);
        resolutionlabels(res1, res2, res3, res4, res5, res6);
        updateLeftBoxes();
        updateRightBoxes();
        updateNotePositions();
        updateActiveStates();
        updateCenterText();
        drawLines();

        // ========================================
        // DROPDOWN MODE SWITCHING
        // ========================================
        const dropdown = document.getElementById('dropdown');
        dropdown.addEventListener('change', (e) => {
            const selectedIndex = parseInt(e.target.value);
            dropdownMode = selectedIndex;
            
            const config = MODE_CONFIG[dropdownMode];
            
            // Update UI labels
            document.getElementById('left-label').textContent = config.leftLabel;
            document.getElementById('right-label').textContent = config.rightLabel;
            document.getElementById('arrow').innerHTML = config.arrowSVG;
            centerTextElement.textContent = config.centerText;
            
            // Update box counts from config
            numLeftBoxes = config.numLeftBoxes;
            numRightBoxes = config.numRightBoxes;
            
            // Reset active box to 0
            activeLeftBox = 0;
            
            // Recreate boxes with new configuration
            createBoxes();
            switch (dropdownMode) {
                case 0:
                    calculatedoms(activeNote);
                    dom7labels(dom1, dom2, dom3, dom4);
                    calculateresolutions(activeLeftBox);
                    resolutionlabels(res1, res2, res3, res4, res5, res6);
                    break;
                case 1:
                    calculatepivots(activeNote);
                    resolutionlabels(piv1, piv2, piv3, piv4, piv5, piv6);
                    calculatedims(activeLeftBox);
                    dim7labels(dim1, dim2, dim3, dim4);
                    break;
            }
            updateLeftBoxes();
            updateRightBoxes();
            updateActiveStates();
            drawLines();
        });
    </script>
</body>
</html>